#!/usr/bin/env bash
executable=$(basename $0)
if [ "$executable" == "vegen-clang" ]
then
  clang=@LLVM_TOOLS_BINARY_DIR@/clang
elif [ "$executable" == "vegen-clang++" ]
then
  clang=@LLVM_TOOLS_BINARY_DIR@/clang++
else
  echo "Error invoking vegen-clang"
  exit 1
fi

loadlib = yes
for arg in $*
do
  if test arg = -fno-vectorize
  then loadlib = no
  fi
done

if test loadlib = yes
lib = -Xclang -load -Xclang @CMAKE_BINARY_DIR@/gslp/libGSLP.so

exec $clang $lib\
       -mllvm --wrappers-dir=@CMAKE_BINARY_DIR@\
       $@\
       -fno-slp-vectorize -fno-vectorize
